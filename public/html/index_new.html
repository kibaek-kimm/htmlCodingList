<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Coding list Test</title>


        <script type="text/javascript" src="http://image.reebok.co.kr/js/jquery/jquery-1.4.2.js"></script>

        <link rel="stylesheet" href="http://image.adidas.co.kr/css/adidas/adidas_r.css">
        <style media="screen">
            .wrapper{
                width: 100%;
                position: relative;
            }

            .btn-ctm{
                width: 120px;
                position: fixed;
                top: 0;
                right: 0;
            }

            .wrapper .title{
                padding: 15px 0;
                text-align: center;
                background: #ccc;
                font:700 20px 'NotoSansKR';
            }

            .wrapper .col_box{
                padding: 0 10px;
            }

            .wrapper .col_box ul{
                display: -webkit-flex;
                display: -ms-flex;
                display: flex;
                border-bottom: 1px dashed  #ddd;
            }

            .wrapper .col_box ul li{
                padding: 10px;
            }

            .wrapper .col_box ul li.name{
                width: 200px;
                padding-top: 20px;
                font:500 13px 'NotoSansKR';
            }

            .wrapper .col_box ul li.name a{
                color: #000;
            }

            .wrapper .col_box ul li.desc{
                width: 100%;
            }

            .wrapper .col_box ul li.desc input{
                width: 100%;
                height: 35px;
                padding-left: 10px;
                font:500 13px 'NotoSansKR';
                color: #000;
            }

        </style>
    </head>
    <body>


        <script type="text/javascript">
            let htmlData = {};

            const submitInfo = () => {
                var data = {
                    htmlList : htmlData,
                    test : 111
                };

                $.ajax({
                    type: 'POST',
                    url: '/modifyHtmlJson',
                    data: data,
                    beforeSend : function(){
                        $('body').append('<div id="loading" style="width:100%;height:100%;position:absolute;top:0;left:0;z-index:100;background:rgba(255,255,255,0.7)"><span style="position:absolute;top:50%;left:50%;width:100px;height:30px;font-size:12px;line-height:30px;margin:-15px 0 0 -50px;text-align:center;">Loading...</span></div>')
                    },
                    success:function(result){
                        $('#loading').remove();

                        console.log(result);
                    },
                    error:function(e){
                        $('#loading').remove();
                        console.log(e.responseText);
                    },
                    dataType : 'json',
                });

                //
                //
                // type: 'POST',
                // url: url,
                // data: data,
                // success: success,
                // dataType: dataType





                return false;
            };

            const bindEvent = () => {
                console.log(11);
                var inputArray = document.querySelectorAll('input[type="text"]')
                inputArray = [...inputArray]

                inputArray.map(value => {
                    value.addEventListener('keyup',event =>{
                        var elem = event.currentTarget;
                        var key = elem.dataset.key;
                        var index = elem.dataset.index;

                        htmlData[key]['htmlData'][index].desc = event.target.value.replace(/"/,'\"');
                    });
                });
            }

            const renderHTML = () => {
                console.log('render');
                let htmlString = `<div class="wrapper"><a class="btn-ctm" href="javascript:void(0)" onclick="submitInfo()"><span>저장하기</span></a>`;
                for(var key in htmlData){
                    let menuDepth = key.split('___');
                    menuDepth = menuDepth.length;

                    htmlString += `<div class="title">${key.replace(/root/,'').replace(/___/,'/')}</div>`;

                    htmlData[key]['htmlData'].map((value , index) => {
                        htmlString += `
                            <div class="col_box">
                                <ul>
                                    <li class="name"><a href="#">${value.name.replace(/___,' --> '/)}</a></li>
                                    <li class="desc"><input type="text" id="${key+'___'+value.name.replace(/\.html/,'')}" value="${value.desc ? value.desc : ''}" data-key="${key}" data-index="${index}"></li>
                                </ul>
                            </div>
                        `
                    });
                }

                htmlString += `</div>`;
                document.getElementsByTagName('body')[0].innerHTML = htmlString
                bindEvent();
            };



            $.ajax({
               url: '/data/codingListInfo.json',
               dataType : 'json',
               beforeSend : function(){
                   $('body').append('<div id="loading" style="width:100%;height:100%;position:absolute;top:0;left:0;z-index:100;background:rgba(255,255,255,0.7)"><span style="position:absolute;top:50%;left:50%;width:100px;height:30px;font-size:12px;line-height:30px;margin:-15px 0 0 -50px;text-align:center;">Loading...</span></div>')
               },
               success:function(result){
                    $('#loading').remove();
                    htmlData = result;
                    renderHTML();
                    console.log(result);
               },
               error:function(e){
                   $('#wrap').html('<div class="nodata">데이터를 로드 할 수 없습니다.</div>');
                   $('#loading').remove();
               }
           });


            var testObj1 = {
                root : {
                    path :"/",
                    htmlData : [
                        {
                            name : "event_list.html",
                            desc : ''
                        },
                        {
                            name : "payment.html",
                            desc : ''
                        }
                    ]
                },
                root___event : {
                    path :"/",
                    htmlData : [
                        {
                            name : "iniki.html",
                        },
                        {
                            name : "weg.html",
                        }
                    ]
                }
            };

            var testObj2 = {
                root : {
                    path :"/",
                    htmlData : [
                        {
                            name : "event_list.html",
                            desc : 'qwdqwfqwf'
                        },
                        {
                            name : "payment.html",
                            desc : 'test'
                        }
                    ]
                },
                root___event : {
                    path :"/",
                    htmlData : [
                        {
                            name : "iniki.html",
                        }
                    ]
                }
            };

            // console.log('--------------');
            // console.log('--------------');
            // console.log('--------------');
            // console.log(Object.assign(testObj1 , testObj2));
            // console.log('--------------');
            // console.log('--------------');
            // console.log('--------------');




        </script>
    </body>
</html>
